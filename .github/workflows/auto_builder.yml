name: 🚀 AI Tools Factory - Daily Auto-Builder

on:
  schedule:
    - cron: '0 0 * * *'  # Daily
  workflow_dispatch:
    inputs:
      debug_mode:
        description: 'Run in debug mode?'
        required: false
        default: false
        type: boolean

env:
  PYTHON_VERSION: '3.11'
  TOOLS_DIR: 'tools'

jobs:
  build-tools:
    name: 🛠 Build & Deploy AI Tools
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: 📦 Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 🐍 Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: 📦 Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: 🚀 Run AI Tool Generator
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GH_TOKEN_SYSTEM: ${{ secrets.GH_TOKEN_SYSTEM }}
          REPO_NAME_SYSTEM: SRG1107/Ai-tools-factory 
          DEBUG_MODE: ${{ github.event.inputs.debug_mode }}
        run: |
          echo "🔁 Running main.py"
          python main.py

      - name: 🧩 Update Index Page
        if: ${{ always() }}
        run: |
          echo "📦 Running update_index.py if exists"
          if [ -f "update_index.py" ]; then
            python update_index.py
          else
            echo "ℹ️ No update_index.py found"
          fi

  report:
    name: 📊 Daily Summary
    needs: build-tools
    runs-on: ubuntu-latest
    if: ${{ always() }}

    steps:
      - name: 📄 Create Report
        run: |
          echo "📅 Date: $(date)" > summary.md
          echo "✅ Status: ${{ needs.build-tools.result }}" >> summary.md
          echo "📁 Tools: https://github.com/${{ github.repository }}/tree/${{ env.TOOLS_DIR }}" >> summary.md

      - name: 📤 Upload Summary Report
        uses: actions/upload-artifact@v4
        with:
          name: daily-summary
          path: summary.md